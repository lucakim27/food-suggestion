{% extends "base.html" %}
{% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='history.css') }}">
{% endblock %}
{% block content %}
<div class="history-container">
    {% if combined_history %}
    <ul id="price_history">
        {% for item in combined_history|sort(attribute='timestamp', reverse=true) %}
        <li>
            <span>{{ item.dish_name }} - {{ item.timestamp|time_ago }}</span><br>
            {% if item.price is defined %}
            <form method="POST" action="{{ url_for('dishes.update_price') }}" style="display:inline;">
                <input type="hidden" name="history_id" value="{{ item.id }}">
                <input type="text" name="price" value="{{ item.price }}">
                <select class="form-select" id="currency" name="currency">
                    {% for value in currency %}
                    <option value="{{ value.Code }}" {% if value.Code==item.currency %}selected{% endif %}>{{
                        value.Currency }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="button update-button">Update</button>
            </form>

            <form method="POST" action="{{ url_for('users.deletePriceRoute') }}" style="display:inline;">
                <input type="hidden" name="history_id" value="{{ item.id }}">
                <button type="submit" class="button delete-button">Delete</button>
            </form>
            {% endif %}
            {% if item.spiciness is defined %}
            <form method="POST" action="{{ url_for('dishes.rate_dish') }}" style="display:inline;">
                <input type="hidden" name="history_id" value="{{ item.id }}">

                <!-- Spiciness -->
                <select id="spiciness-{{ item.id }}" name="spiciness">
                    <option value="0" {% if item.spiciness==0 %}selected{% endif %}>Not at all spicy</option>
                    <option value="1" {% if item.spiciness==1 %}selected{% endif %}>A little spicy</option>
                    <option value="2" {% if item.spiciness==2 %}selected{% endif %}>Mildly spicy</option>
                    <option value="3" {% if item.spiciness==3 %}selected{% endif %}>Moderately spicy</option>
                    <option value="4" {% if item.spiciness==4 %}selected{% endif %}>Very spicy</option>
                    <option value="5" {% if item.spiciness==5 %}selected{% endif %}>Extremely spicy</option>
                </select>

                <!-- Sweetness -->
                <select id="sweetness-{{ item.id }}" name="sweetness">
                    <option value="0" {% if item.sweetness==0 %}selected{% endif %}>Not sweet at all</option>
                    <option value="1" {% if item.sweetness==1 %}selected{% endif %}>Barely sweet</option>
                    <option value="2" {% if item.sweetness==2 %}selected{% endif %}>Mildly sweet</option>
                    <option value="3" {% if item.sweetness==3 %}selected{% endif %}>Moderately sweet</option>
                    <option value="4" {% if item.sweetness==4 %}selected{% endif %}>Very sweet</option>
                    <option value="5" {% if item.sweetness==5 %}selected{% endif %}>Extremely sweet</option>
                </select>

                <!-- Sourness -->
                <select id="sourness-{{ item.id }}" name="sourness">
                    <option value="0" {% if item.sourness==0 %}selected{% endif %}>Not sour at all</option>
                    <option value="1" {% if item.sourness==1 %}selected{% endif %}>Slightly sour</option>
                    <option value="2" {% if item.sourness==2 %}selected{% endif %}>Moderately sour</option>
                    <option value="3" {% if item.sourness==3 %}selected{% endif %}>Quite sour</option>
                    <option value="4" {% if item.sourness==4 %}selected{% endif %}>Very sour</option>
                    <option value="5" {% if item.sourness==5 %}selected{% endif %}>Extremely sour</option>
                </select>

                <!-- Texture -->
                <select id="texture-{{ item.id }}" name="texture">
                    <option value="0" {% if item.texture==0 %}selected{% endif %}>Very Soft</option>
                    <option value="1" {% if item.texture==1 %}selected{% endif %}>Soft</option>
                    <option value="2" {% if item.texture==2 %}selected{% endif %}>Slightly Soft</option>
                    <option value="3" {% if item.texture==3 %}selected{% endif %}>Moderate</option>
                    <option value="4" {% if item.texture==4 %}selected{% endif %}>Slightly Hard</option>
                    <option value="5" {% if item.texture==5 %}selected{% endif %}>Hard</option>
                </select>

                <!-- Temperature -->
                <select id="temperature-{{ item.id }}" name="temperature">
                    <option value="0" {% if item.temperature==0 %}selected{% endif %}>Cold</option>
                    <option value="1" {% if item.temperature==1 %}selected{% endif %}>Cool</option>
                    <option value="2" {% if item.temperature==2 %}selected{% endif %}>Slightly Cool</option>
                    <option value="3" {% if item.temperature==3 %}selected{% endif %}>Warm</option>
                    <option value="4" {% if item.temperature==4 %}selected{% endif %}>Hot</option>
                    <option value="5" {% if item.temperature==5 %}selected{% endif %}>Very Hot</option>
                </select>

                <!-- Healthiness -->
                <select id="healthiness-{{ item.id }}" name="healthiness">
                    <option value="0" {% if item.healthiness==0 %}selected{% endif %}>Not healthy at all</option>
                    <option value="1" {% if item.healthiness==1 %}selected{% endif %}>Unhealthy</option>
                    <option value="2" {% if item.healthiness==2 %}selected{% endif %}>Below average</option>
                    <option value="3" {% if item.healthiness==3 %}selected{% endif %}>Moderately healthy</option>
                    <option value="4" {% if item.healthiness==4 %}selected{% endif %}>Healthy</option>
                    <option value="5" {% if item.healthiness==5 %}selected{% endif %}>Very healthy</option>
                </select>

                <!-- Overall Rating -->
                <select id="rating-{{ item.id }}" name="rating">
                    <option value="0" {% if item.rating==0 %}selected{% endif %}>Terrible</option>
                    <option value="1" {% if item.rating==1 %}selected{% endif %}>Bad</option>
                    <option value="2" {% if item.rating==2 %}selected{% endif %}>Below Average</option>
                    <option value="3" {% if item.rating==3 %}selected{% endif %}>Average</option>
                    <option value="4" {% if item.rating==4 %}selected{% endif %}>Good</option>
                    <option value="5" {% if item.rating==5 %}selected{% endif %}>Excellent</option>
                </select>

                <!-- Submit Button -->
                <button type="submit" class="button update-button">Update</button>
            </form>

            <!-- Delete Button -->
            <form method="POST" action="{{ url_for('users.deleteHistoryRoute') }}" style="display:inline;">
                <input type="hidden" name="history_id" value="{{ item.id }}">
                <button type="submit" class="button delete-button">Delete</button>
            </form>
            {% endif %}
            {% if item.dietary is defined %}
            <form method="POST" action="{{ url_for('dishes.update_dietary') }}" style="display:inline;">
                <input type="hidden" name="history_id" value="{{ item.id }}">
                <select class="form-select" id="dietary" name="dietary">
                    {% for dietary in dietaries %}
                    <option value="{{ dietary.dietary }}" {% if item.dietary==dietary.dietary %}selected{% endif %}>{{
                        dietary.dietary }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="button update-button">Update</button>
            </form>
            <form method="POST" action="{{ url_for('users.deleteDietaryRoute') }}" style="display:inline;">
                <input type="hidden" name="history_id" value="{{ item.id }}">
                <button type="submit" class="button delete-button">Delete</button>
            </form>
            {% endif %}
            {% if item.ingredient is defined %}
            <form method="POST" action="{{ url_for('dishes.update_ingredient') }}" style="display:inline;">
                <input type="hidden" name="history_id" value="{{ item.id }}">
                <select class="form-select" id="ingredient" name="ingredient">
                    {% for ingredient in ingredients %}
                    <option value="{{ ingredient.ingredient }}" {% if item.ingredient==ingredient.ingredient
                        %}selected{% endif %}>{{ ingredient.ingredient }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="button update-button">Update</button>
            </form>
            <form method="POST" action="{{ url_for('users.deleteIngredientRoute') }}" style="display:inline;">
                <input type="hidden" name="history_id" value="{{ item.id }}">
                <button type="submit" class="button delete-button">Delete</button>
            </form>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p id="price_history">No history available.</p>
    {% endif %}
</div>
{% endblock %}